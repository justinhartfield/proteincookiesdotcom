function recipeSubstitution(t){return{recipeId:t.recipeId||"unknown",yield:t.yield||12,servingSize:t.servingSize||75,originalIngredients:t.ingredients||[],currentIngredients:[],expandedIngredient:null,unitSystem:"metric",hydrationAdjustments:[],nutritionDeltas:[],batchNutritionDeltas:[],init(){this.currentIngredients=JSON.parse(JSON.stringify(this.originalIngredients)),this.currentIngredients.forEach(t=>{t.originalId=t.id,t.isSwapped=!1,t.originalAmount=t.amount}),this.recalculate()},getIngredient:t=>window.INGREDIENTS?window.INGREDIENTS[t]:null,getDisplayName(t){const e=this.getIngredient(t);return e?e.name:t},getSubstitutes(t){const e=this.getIngredient(t);return!e||e.isFixed?[]:(e.substitutes||[]).map(t=>{const e=this.getIngredient(t);return e?{id:t,name:e.name,swapNote:e.swapNote||null,isSpecialSwap:e.isSpecialSwap||!1}:null}).filter(Boolean)},canSubstitute(t){const e=this.getIngredient(t);return e&&!e.isFixed&&(e.substitutes||[]).length>0},toggleIngredient(t){if(this.expandedIngredient===t)this.expandedIngredient=null;else{const e=this.currentIngredients.find(e=>e.id===t||e.originalId===t);e&&this.canSubstitute(e.originalId)&&(this.expandedIngredient=t)}},selectSubstitute(t,e){const n=this.currentIngredients.findIndex(e=>e.originalId===t);if(-1===n)return;const i=this.currentIngredients[n],r=this.getIngredient(t),a=this.getIngredient(e);if(!r||!a)return;let s=i.originalAmount;a.amountRatio&&(s=Math.round(i.originalAmount*a.amountRatio)),this.currentIngredients[n]={...i,id:e,amount:s,isSwapped:e!==t,previousId:i.id},this.expandedIngredient=null,this.recalculate()},revertIngredient(t){const e=this.currentIngredients.findIndex(e=>e.originalId===t);if(-1===e)return;const n=this.currentIngredients[e];this.currentIngredients[e]={...n,id:n.originalId,amount:n.originalAmount,isSwapped:!1},this.recalculate()},resetAll(){this.currentIngredients.forEach((t,e)=>{this.currentIngredients[e]={...t,id:t.originalId,amount:t.originalAmount,isSwapped:!1}}),this.expandedIngredient=null,this.recalculate()},recalculate(){this.calculateHydration(),this.calculateNutrition()},calculateHydration(){this.hydrationAdjustments=[],this.currentIngredients.forEach(t=>{if(!t.isSwapped)return;const e=this.getIngredient(t.originalId),n=this.getIngredient(t.id);if(!e||!n)return;if("dry"!==e.category)return;const i=n.hydrationFactor-e.hydrationFactor,r=n.amountRatio?t.originalAmount*n.amountRatio:t.originalAmount,a=Math.round(i*r);0!==a&&this.hydrationAdjustments.push({ingredientName:n.name,originalName:e.name,adjustmentMl:a,message:a>0?`+${a}ml liquid`:`${a}ml liquid`})})},getTotalHydrationAdjustment(){return this.hydrationAdjustments.reduce((t,e)=>t+e.adjustmentMl,0)},checkHasHydrationAdjustment(){return this.hydrationAdjustments.length>0},calculateNutrition(){this.nutritionDeltas=[],this.batchNutritionDeltas=[];let t=0,e=0,n=0,i=0;this.currentIngredients.forEach(r=>{if(!r.isSwapped)return;const a=this.getIngredient(r.originalId),s=this.getIngredient(r.id);if(!a||!s)return;const d=r.originalAmount,o=r.amount,u=t=>{const e=a.macrosPer100g[t]/100*d;return s.macrosPer100g[t]/100*o-e};t+=u("calories"),e+=u("protein"),n+=u("fat"),i+=u("carbs")});const r=this.yield;Math.abs(t)>=5&&this.batchNutritionDeltas.push({name:"Calories",delta:Math.round(t),formatted:this.formatDelta(Math.round(t),"")}),Math.abs(e)>=1&&this.batchNutritionDeltas.push({name:"Protein",delta:Math.round(e),formatted:this.formatDelta(Math.round(e),"g")}),Math.abs(n)>=1&&this.batchNutritionDeltas.push({name:"Fat",delta:Math.round(n),formatted:this.formatDelta(Math.round(n),"g")}),Math.abs(i)>=1&&this.batchNutritionDeltas.push({name:"Carbs",delta:Math.round(i),formatted:this.formatDelta(Math.round(i),"g")}),Math.abs(t/r)>=1&&this.nutritionDeltas.push({name:"Calories",delta:Math.round(t/r),formatted:this.formatDelta(Math.round(t/r),"")}),Math.abs(e/r)>=.5&&this.nutritionDeltas.push({name:"Protein",delta:Math.round(e/r),formatted:this.formatDelta(Math.round(e/r),"g")}),Math.abs(n/r)>=.5&&this.nutritionDeltas.push({name:"Fat",delta:Math.round(n/r),formatted:this.formatDelta(Math.round(n/r),"g")}),Math.abs(i/r)>=1&&this.nutritionDeltas.push({name:"Carbs",delta:Math.round(i/r),formatted:this.formatDelta(Math.round(i/r),"g")})},formatDelta:(t,e)=>t>0?`+${t}${e}`:t<0?`${t}${e}`:`0${e}`,checkHasSubstitutions(){return this.currentIngredients.some(t=>t.isSwapped)},getSubstitutionCount(){return this.currentIngredients.filter(t=>t.isSwapped).length},getFormattedAmount(t){return"metric"===this.unitSystem?`${t.amount}g`:t.usUnit||`${t.amount}g`},isExpanded(t){return this.expandedIngredient===t},getIngredientClasses(t){let e="ingredient-item flex flex-col py-3 transition-all duration-200";return t.isSwapped&&(e+=" bg-brand-50 rounded-xl px-3 -mx-3"),this.canSubstitute(t.originalId)&&(e+=" cursor-pointer hover:bg-slate-50"),e}}}"undefined"!=typeof window&&(window.recipeSubstitution=recipeSubstitution);